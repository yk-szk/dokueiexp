{%- if read_only %}
<script>
       function handleChange() {
              // do nothing in admin mode
       }
</script>
{%- else %}
<script>
       function failureCallback(error) {
              alert(error);
       }
       function handleChange(obj) {
              obj.classList.remove('notset');
              const sliders = document.querySelectorAll('.slider input');
              const values = {}
              const dones = Array.from(sliders).filter(e => !e.classList.contains('notset'));
              const n_all = sliders.length;
              const n_dones = dones.length;
              dones.forEach(e => values[e.id] = e.value)
              async function putData(url = '', data = {}) {
                     const response = await fetch(url, {
                            method: 'PUT',
                            mode: 'cors',
                            cache: 'no-cache',
                            credentials: 'same-origin',
                            headers: {
                                   'Content-Type': 'application/json'
                            },
                            redirect: 'follow',
                            referrerPolicy: 'no-referrer',
                            body: JSON.stringify(data)
                     })
                     return response.json();
              }
              putData(location.href, values)
                     .then(data => {
                            if (n_all == n_dones) {
                                   document.getElementById("case_id").classList.add("completed");
                            }
                            console.log(data);
                     }).catch(failureCallback);
       }
</script>
{%- endif %}
<div class="grid">
       {%- for slider in sliders %}
       <label for="{{slider.label_id}}">{{slider.label}}</label>
       <div>
              <div class="label"><span>{{slider.label_left}}</span><span>{{slider.label_right}}</span></div>
              <div class="slider">
                     <input type="range" id="{{slider.label_id}}" name="{{slider.label_id}}" min="0" max="100"
                            value={{data.get(slider.label_id, 50)}}
                            class="{{'notset' if slider.label_id not in data else ''}}"
                            onClick="handleChange(this)" onTouchEnd="handleChange(this)" {{'disabled' if read_only else '' }}>
              </div>
       </div>
       {%- endfor %}
</div>
